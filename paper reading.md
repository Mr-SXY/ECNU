
摘要：离焦深度（DFD）提出了一种简单的光学装置，可以通过浅景深成像来恢复场景的形状。尽管已经提出了许多用于DFD的方法，但是对捕获图像之间对齐的特定问题的关注却很少。固有的移位变量散焦通常会阻止标准套准技术获得成功的形状重建所需的精度。在本文中，我们在一个统一的框架中解决了DFD和配准问题，并利用它们之间的相互关系为两个线索提供了更好的解决方案。我们在配准和散焦模糊之间建立了正式的联系，找到了它的局限性，并揭示了标准的配准和深度估计孤立方法的弱点。通过最小化能量来解决该问题。通过证明其与著名的牛顿-拉夫森方法的等效性以及新兴线性系统的收敛性证明，可以证明相关数值方案的效率。通过GPU计算来处理DFD的计算密集型方法，该方法将新方法与同时配准相结合。实验结果表明，恢复的形状对配准中的微小错误具有很高的敏感性，并验证了建议的方法优于两种分别应用配准和DFD替代方案的优越性能。

###### 简介

视觉推断的基本目标是根据图像提供场景结构的估计。众所周知，从单个视图提取形状是一个不适定的问题。因此，可靠的方法假定具有场景的多个视图以恢复形状。常见的三角测量方法（例如，立体视觉[4]，[15]，[26]，结构化光[12]或运动产生的结构[31]）采用针孔成像模型，而忽略了镜头模糊。通过浅景深成像会产生变化的模糊（散焦），对场景的形状进行编码。由于场景的未知潜在全焦点图像，单个图像不足以进行深度估计。因此，离焦深度（DFD）会尝试从至少两个以不同焦点设置[7]-[9]，[29]，[32]，[33]拍摄的图像中提取深度（至少）。在DFD中，人们尝试解决反问题，即根据图像形成模型恢复与观察结果最相符的形状。紧密相关的方法是多光圈摄影[11]和共焦立体声[14]。

###### 问题陈述

**在标准DFD中，场景中的每个点都有两个独特的观察结果。然后将这两个观测值进行比较，以估计一个点的深度。在对齐的图像中，相应的点位于相同的坐标下，但是当图像未对齐时，对应关系将丢失。** DFD要求场景具有纹理图案（高频）。因此，在大多数情况下，特别是由于采样和量化，轻微的未对准会严重影响恢复的形状。**图1**展示了在轻微错位情况下重构形状的简并性。因此，在进行深度评估[8]，[32]，[33]之前，需要付出很大的努力来配准输入图像。先前在[32]，[33]中解决了DFD中精确配准的问题，而作者讨论了在受控实验室设置中捕获的图像在0.1像素误差下的对齐水平。对准问题也用共焦立体声[14]解决，在那里开发了光学模型以实现亚像素精度。配准是计算机视觉中公认的领域。今天的通用方法甚至能够在不同的模态之间对齐图像（参见[35]及其中的参考文献）。在理想情况下，该算法应该能够在场景的所有投影中检测到相同的特征（角，曲率或强度），而不管特定的几何和光度转换如何。但是，配准精度受几个因素的限制，例如离散化（采样），光度转换，模糊或噪声[23]。一种基本方法是通过最佳匹配观测值之间的**密集外观模式来定义配准变换**。其他方法匹配稀疏的点集（称为兴趣点），以更好地应对几何和光度转换。 **SIFT（尺度不变特征变换）**[19]提出了一组著名的兴趣点。尽管**密集的外观配准可以处理相对平滑的图案**，但在低对比度下，稀疏方法需要图像中存在独特的提示（通常是角落），并且在缩放，旋转和平移方面具有一定的不变性。然而，上述方法很少充分地应对**散焦模糊**。记录不同模糊图像仍然是一个特殊的挑战。为了解决这个问题，焦距堆栈方法经常放弃基于观测的标准配准方法，而是使用受控设备上的指定目标来进行校准[16]。当涉及非对称散焦内核时，DFD中的配准问题会升级。在这种情况下，定向特征（例如边缘或拐角）会被涂抹，从而导致不正确的对齐。图2指出了DFD集精确对齐的困难，因为清晰的图像特征与其模糊对应物相匹配。图2显示了基于SIFT的配准结果。当前的DFD方法将注册和深度评估阶段[8]，[9]，[32]，[33]分开，而忽略了它们之间的相互关系。一方面，可以利用已知的局部模糊（即深度）来匹配观察结果，从而改善配准。另一方面，准确的配准是准确的深度（模糊）估计的必要条件。**配准和深度的结合**，是采用组合方法的原因，以促使统一的成本函数趋向于全局最小值。建议的范例要求同时满足配准和深度

fig1--未对准对DFD 3D重建的影响。 上：倾斜平面的合成情况，由于（1,1）像素的平移而未对齐。 下：实际图像，此处通过平移（1.8,2.3）像素而变形以产生未对准。 左侧是中间一列的具有3D重构的示例图像（来自两个）。 为便于比较，右图显示了从已配准的集合进行的形状重构。 注意与较小位移有关的变形。

fig2--散焦对在两个不同焦点位置捕获/模拟的两对图像上显示的套准的影响。 左：用于DFD的真实图像集中的补丁，描述了蜘蛛的一部分。 请注意，模糊特征旨在精确匹配其锐利的配准（反之亦然）。 右：合成的随机点图案，被不对称内核均匀地模糊。 左侧的重叠红色圆圈是SIFT关键点，而右侧则根据SIFT配准映射这些点。 为了进行比较，蓝色加号是我们的配准结果，从而改善了形状恢复，如第5节所示。

###### 先前工作

DFD是一个活跃的研究领域，主要有两种方法：频率（傅立叶）[17]，[33]，[35]和空间方法[7]，[9]。在频域中，人们经常通过用离散范围的模糊核对观测值进行模糊处理来寻找潜伏辐射图像。然后，通过最小化满足图像形成模型的目标函数，获得指示深度的局部内核的比例。需要足够大的域来估计局部频率以及的离散范围通常会导致深度和深度不连续的区域出现误差。连续建模最流行的最小化策略是变化框架[34]。 DFD中的变分方法提出了一种空间方法，可以提供密集且连续的解决方案，同时提供一个基于数学的形式主义基础，明确表达模型假设。数据一致性和空间平滑度的联合优化有效地填充了不明确区域中的数据值，同时保留了其不连续性。**在本文中，我们为单个能量函数建立了配准和深度模型。为了简化模型，避免辐射图的恢复，我们通过相对模糊[8]，[9]对深度进行编码，并通过相似性变换进行配准**。这种变换适用于相机/场景的垂直于光轴的刚性运动，而标尺符合光学放大倍数。我们的理论分析表明，无论进行哪种变换，仍然可以将观察结果关联起来，通过[2]，[8]中的相对模糊对DFD问题建模。所建议的数值解决方案本着[5]，[8]的精神，并基于Euler-Lagrange有限差分方案的线性化，并通过嵌套（滞后）迭代进行求解。此外，我们还采用了金字塔形的从粗到细的方法来更好地应对深度的局部最小值和较大的偏差。但是，我们建议对[9]的先前方法进行一些修改，以提高其稳定性。新的理论观察证明了我们的方案与著名的NewtonRaphson方法的等效性，从而证明了我们的方法的正确性。最后，出现的线性系统收敛的证明建立了我们的数值稳定性。 DFD中的配准与立体视觉中的弱校准具有相同的作用，后者最终会恢复基本矩阵。在立体声中，图像是在较宽的景深（因此由针孔模型近似）中捕获的，并且没有（深度变化）模糊。这些条件允许典型的配准方法适用于立体声弱校准。尽管如此，由于移位变化的模糊和对配准误差的高度敏感性（以像素的分数为单位），DFD问题不断加深，对配准提出了新的挑战。因此，先前发现将深度估计与配准相结合是一种可行的解决方案[21]。然而，与我们的方法相反，在[21]中，模糊被假定为在空间中是恒定的，从而将该模型限制在等焦表面上，而不是一般情况。

并行实现

三维重建方法的实时性通常是一个理想的特性。通常，一种计算成本高昂的方法阻止了一种方法的传播和流行。与立体视觉相似的三角剖分方法通常是流行的深度估计技术，以提供可接受的精度和实时性能。然而，像立体视觉这样的方法在许多情况下并不容易适用。此前，渡边等人提出了一种实时DFD系统。[32]使用主动照明，允许计算上便宜的解码。在引入实时性能（VGA图像大小）的同时，该方法还需要额外的投影系统，并且被发现对物体反射特性高度敏感。在这项研究中，我们处理被动DFD的问题，其中不涉及光发射器，以应付相关的密集运算在GPU上并行处理。我们的实现允许在2秒钟内计算出1百万像素的密集深度图，同时进行自我注册。如果DFD在没有注册的情况下被激活，则计算速度可以提高一个数量级。这些数字是基于CUDA-C代码实现的快速收敛数值方案，当运行在桌面NVIDIA GPU上时。据我们所知，这引入了文献中已知的最高DFD计算速率。

1.4 contribution

由于模糊度的变化，在浅景深拍摄的图像的精确配准带来了一个挑战。利用配准和模糊之间的相互关系来提高对齐和形状恢复的精度。所建议的方法提出了一种用于估计深度指示器的自校准方法2，类似于立体视觉中的视差。

相对模糊模型已被公认为DFD的可靠近似值，从而产生了一个合理且稳定的深度指示器（另请参见[18]中的最新工作）。然而，相对模糊模型适用于未对准图像的术语尚未给出。在这篇文章中，我们正式地推导出了相对模糊模型，揭示了它的局限性。这种方法也可用于光学离焦图像的精确配准。

并证明了数值方法的稳定性。为此，证明了出现的内不动点迭代格式的收敛性。

在gpd上新导出的dfan方案允许高效的并行dfu实现。据我们所知，这是文献中第一个实时和自校准的DFD。

我们的实验测试证明了标准外观和基于特征的方法在精确配准浅景深图像方面的局限性。试验台包括合成数据和真实数据，并进行定量和定性比较。目前大多数可用的数据集都是室内图像，通常在实验室设施中通过控制照明进行捕捉。我们在此介绍一种新的野外采集数据，并提供给公众使用。结果表明，尽管失准涉及3，但深度恢复是成功的。我们进一步将我们的方法与基于稠密外观的配准和广泛使用的SIFT匹配进行了比较。从所建议的方法中得到的改进结果证明了我们的范式是正确的。



#### 成像模型

让我们定义场景的潜在全焦点视图，即辐射图像。 r: ⊂ R^2 → [0,∞)表示紧凑支撑。 我们考虑在相同的照明条件下但焦点设置不同的情况下捕获的两个场景图像。 我们的第一个观测值I1：→[0，∞）是通过将散焦算子D1施加在辐射图像上而形成的：

​				I1(x) = D1 （z(x)） 运算r(x)

请注意，对于特定的相机，散焦运算符取决于场景的形状z：→（0，∞）和光学设置（由下标确定）。 作为光学设置，我们指的是场景中焦平面的位置，或图像传感器与相机中镜头之间的距离。 **新运算符号**表示将在第2.1节中定义的**平移线性操作**。 我们使用3D坐标轴（X，Y，Z），其中Z与相机的光轴重合，并且（X，Y）跨越垂直平面。请注意，对于特定的相机，散焦运算符取决于场景的形状z：→（0，∞）和光学设置（由下标确定）。 

虽然先前的DFD模型假定图像之间的完美对齐，但在捕获第二个图像之前，我们允许摄像机/物体的相对位移和旋转。 等焦和平面运动会在（X，Y）平面内施加位移并绕光轴（Z）旋转。 除此几何变换之外，还有一个光学标尺，通常称为放大倍数[27]。 然后，可以用相似度图P描述所得的变换。请注意，根据几何光学模型（请参见[10]附录D.1中的证明），比例尺是恒定的，与深度无关。 在这些假设下，第二张图像的图像形成为：

​					I2 = D2 （z(Px)）运算r(Px)

当散焦算子安装在相机框架上时，形状和辐射率图都嵌入在对象框架中。



###### 散焦与几何变换

散焦图像通常用线性模型描述，并通过局部卷积应用。 为了解决这个问题，我们采用参数方法，假设已知内核的形状h，并且将深度封装在内核的尺度中：h：λ×z→[0，1），其中λ⊂R2表示a 紧凑的支撑，z代表点深度。 这种建模反映了无像差光学系统，其中逐点散焦内核由相应场景的深度确定，并且明确独立于空间坐标5。 另一个常见的假设是归一化属性：

积分 λ      h（u, z(x)）du = 1, ∀x ∈ O

体现节能。
现在，我们通过以下线性运算在（1）中定义散焦运算符：

![image-20201117205900194](/home/sxy/.config/Typora/typora-user-images/image-20201117205900194.png)

注意，散焦函数h1（·，·）由焦点设置（由下标指示）和局部深度z确定。 我们的DFD集中的第二张图像是在不同的光学设置下捕获的，并具有相似性变换； Px = sRx + t（请参阅第2节），其中s，R，t分别表示比例尺，旋转矩阵和平移矢量。 转换P将第二个图像帧与场景的帧相关联，建议使用以下图像形成模型：

![image-20201117210323299](/home/sxy/.config/Typora/typora-user-images/image-20201117210323299.png)

上式中的图像形成模型将几何变换与散焦算子相关联。 尽管没有像差的假设使内核从依赖关系转移到位置，但旋转会在图像形成过程中考虑到一个相对角度，尤其是对于不对称散焦内核。 可以通过以下方法来描述此成像模型：首先将散焦与反向旋转的核应用于缩放并移动的辐射度图，然后旋转所得图像。 等式（5）在相似性变换下将先前在DFD中的图像形成模型扩展到未对准的物镜框架。 在以下命题中，我们证明了该模型的性质。



###### 相对模糊

通常，任何散焦模型都假定存在一个潜在的辐射图作为散焦观测的来源。 然而，实际上，辐射图是先验未知的，其恢复涉及不稳定且对噪声敏感的去模糊过程。 先前已经显示[10]，在某些条件下，**可以通过找到将观察结果相互映射的模糊函数来恢复深度图，从而消除了估计辐射率的必要性。 这种模糊功能称为相对模糊。** 在本节中，我们将显示在某些条件下，相对模糊范例可以扩展到未对齐的图像。 为此，根据等式，我们开始通过参考（未变换的）观察图像表示辐射图。 （1）：

确实，逆散焦算子的存在是一个关键假设，并将在下面进行讨论。 满足命题（1）和（2），可以转换（2）中的变换顺序和散焦。 这将为我们的变换观测结果提供新的表示形式，其中涉及一个与变换无关的新散焦算符：

请注意，导致这种关系的关键因素是命题（1）和（2）中证明的整流性质。 为了方便起见，现在可以通过将（12）代入（13）并更改T = P-1来直接关联两个输入图像：

同样，可以通过以下方法从转换后的图像中得出参考图像：

注意，所涉及的散焦算子现在都不依赖于几何变换T。实际上，方程（14）通过两个阶段的过程表示观测值之间的映射，首先根据形状（和相应的焦点设置）进行散焦I1，从而获得辐射度图，然后应用一种新的离焦算子形成第二次观测。然后对得到的图像进行几何变换以得到I2。方程（14），（15）表示了两个图像之间映射点的选项，一个从源I1到I2（14）进行映射，另一个从源I1执行到I2（14），反之亦然（15）。每点（像素），一个选项涉及稳定的“正”模糊，另一个选项涉及不稳定的“负”模糊，即去模糊过程。寻找一个稳定的方案的原因分解成两个不相交的集合，其中所有的点被“正”模糊映射。为了讨论（14）和（15）中算子D−1i的存在性，我们把自己限制在一个等焦斑片上。然后用相应的辐射片和散焦核的卷积来模拟该区域的光强分布。对于柱箱核，根据卷积定理（核频率的零交叉），Di是一个不可逆的算子。然而，逆算子对于高斯核是存在的。在实际应用中，高斯核具有较高的条件数，因此对噪声甚至舍入误差非常敏感。这个问题是通过正则化来解决的，比如在Weiner滤波器和[17]，[29]的更新方法中。有趣的是，subarao等人。[29]通过限制强度使其局部表现为三阶多项式函数来处理逆散焦算子。反问题可以明确地表述出来（另见[28]）。



###### 高斯核

在参数方法中，我们假设散焦内核的形状是已知的。高斯形状核可以被证明是理想透镜的近似值。 **从局部方法到整个域的泛化可以用高斯模糊Di（z）= G（Vi）代替（1）中的散焦算子。** 在这个表示中，Vi：z（x）→R +是相对于z的严格单调函数。 根据高斯卷积的自相似性和级联性质，可以用一个函数代替两个方差图Vi，i∈{1，2}，这些函数从它们的差Vr：= V2-V1获得。 现在可以由以下具有单个未知数的相对高斯描述高斯函数，描述与（14）和（15）中的两个观测值相关的算子：



在本文的其余部分，我们将深度称为“相对模糊”，有时会互换这些术语。 此新引入的功能的符号指示模糊的方向，从I1到I2，反之亦然。 这种关系会产生匹配问题，如先前在对齐图像的情况下所示，并且等效于立体声中的对应问题。 注意，如果用于成像的焦平面I1距离相机更近，则正Vr表示相机附近的点，而负值表示距离较远的部分。







fig3.合成和模拟数据集。从左到右：合成平面，等焦面和非对称模糊，杯子和圆柱体。指定的方块显示图像面片的放大，以更好地显示模糊的变化。注意光学设置的变化如何产生不同的模糊范围

上面：以像素为单位的平移（tx，ty）、旋转（θ）和图像（s）之间的增量缩放。下面：针对以下几种方法的配准误差：外观：基于稠密外观的配准，SIFT：基于稀疏SIFT的配准，Our：我们统一的DFD和配准方法。图4示出了受配准精度影响的结果深度图。sift结果中的破折号表示由于缺少关键点而导致配准失败。

4.3

得到的数值格式计算量大，特别是由于递归散焦运算。尽管我们的散焦算子是移位变量，8散焦算子的局部性允许细粒度的平行性。事实上，这种情况对于pde[13]、[20]、[30]的许多解算器是典型的，特别是对于DFD，如前面的[2]所示。对于实时操作（在合理的图像大小上），我们采用我们的数值方案来利用GPU上可用的精细并行性。这一愿望的主要挑战是（28）中稀疏线性系统的有效解。在CPU上，这类线性系统通常用Gauss-Seidel或SOR松弛法求解，具有固有的时序性。然而，经典的Gauss-Seidel方案可以通过红黑策略来放宽，以允许一个并行的替代方案[30]。一个单一的红黑松弛包含两个半迭代，每个迭代更新每个交替点（称为红点和黑点）。所有红/黑点的更新现在是并行的，因为所有依赖项都是上半次迭代中相邻的计数器颜色像素。最后，我们的梯度下降步骤引入了一个显式的并行过程，类似于[2]中的实现。注意，（23）中的积分（和）计算可以通过GPU上的归约过程有效地分配。利用GPU计算的另一个繁重的过程是图像扭曲，它涉及重复的插值。我们的方案通常在不到20次迭代中收敛，超过金字塔中的2-3级。在NVIDIA GeForce GTX 460上，快速收敛方案与细粒度GPU并行性一起引入了每秒0.5mp深度值的速率。当注册模式关闭时，即在对齐的图像上应用DFD时，性能提高了10倍。尽管吞吐量很高，但通过设备优化仍有加速的空间。

fig4.图3中数据集的估计深度（相对模糊）（也可参见表1中的失准和配准误差）。深度颜色代码显示在底部。（a） 无需配准，（b）基于外观的配准，（c）基于SIFT的对齐，（d）我们的方法，以及（e）原始对齐数据的DFD结果，显示用于比较。自上而下：合成平面，具有非对称内核的恒定散焦，杯子和圆柱体。注意（a）中错位的显著影响。**统一方法显示的结果与从对齐数据中获得的深度图最接近**，因此优于测试的备选方案。注意不对称散焦的例子。虽然单独的方法包括伪影，但是我们的方法产生了一个预期的恒定深度（与对齐的数据相比，模糊级别的细微色差是亚像素级的）。杯具筛配失败是由于缺少关键点。

###### 5.实验验证

在本节中，我们将演示我们的方法在三种类型的数据集上的有效性：合成的、模拟的（真实图像在计算上不一致）和新引入的野外采集的真实数据。我们进一步论证了标准配准方法的缺点，特别是在非对称离焦核情况下。

为了进行比较，我们采用了通常分离的方法，其中图像首先被配准，然后用于DFD。然后通过配准精度（如适用）和恢复形状来衡量性能。为此，我们采用了两种不同的配准方法。第一种是基于密集外观匹配，形式上最小化以下目标功能：

我们通过梯度下降将能量函数降到最小，以获得配准，类似于我们的统一方法。

table2--外观：基于外观相似度的注册，SIFT：基于SIFT的注册，我们的：我们统一的DFD和注册方法。 请注意，蜘蛛情况下的规模相对较大（超过2％）。 尽管SIFT的注册与我们在蚁案中的方法一致，但由于缺乏关键点，蜘蛛和无翅目昆虫的登记存在差异。 配准的不准确会在恢复的深度图中产生伪像。 有关详细信息，请参见图6和7。

###### 5.1合成和模拟图像

我们的合成和模拟数据由四个图像对组成，如图3所示。第一个合成数据对倾斜平面的模糊变化进行编码，第二个数据是由非对称核离焦的等焦平面的演示。使用的非对称核是高斯核，左侧（负x值）消失。这个简单的例子说明了标准和单独的注册方法的局限性，其中方向模糊通常被视为位移，从而导致注册错误。我们进一步在模拟真实数据上测试这些方法，其中一幅图像被故意扭曲以产生可控的失调。为此，我们使用了[33]中著名的杯子对和[7]中的圆柱体。有了地面真值转换，我们在表1中报告了注册精度。我们的结果表明，在所有测试用例中，平移误差小于四分之一像素，旋转和缩放误差分别高达0.001°和0.1%。然而，在单独的注册和DFD中，我们发现明显更高的错误。例如，在非对称离焦测试用例（ASK）中，由于方向模糊，两种比较方法都会按预期漂移。虽然SIFT注册在四个测试中的两个成功，但在圆柱体的情况下会获得更大的错误，而杯组9缺少关键点会导致注册失败（表中的虚线符号表示）。注册错误会影响恢复的深度贴图。图4展示了对原始（未对齐）数据进行DFD如何损害深度图评估。虽然事先登记改善了这一结果，仍然留下一些明显的瑕疵。不一致的深度值在非对称内核示例中尤其存在，这是由于注册错误造成的，如表1所示。虽然SIFT匹配的性能优于外观匹配方法，但统一方法仍然可以获得最好的结果，成功地处理了所有的测试用例。注意在图4的右栏中显示的用于比较的对齐数据的结果（没有附加的未对准）。例如，在Cup的情况下，我们的深度图与报告的配准精度为0.1像素的对齐数据相当。深度图中不连续性的守恒是TV正则化项的结果。

5.2

我们用新的真实数据进一步扩展了我们的试验台，这些数据是在nature10中捕获的。这些数据包括微小生物在微观和典型宏观场的中间区域缩放的图像，据我们所知，没有显示DFD的先前数据。特别是，这些照片是在野外从活的蚁狮、蜘蛛和两种无翅目昆虫中捕捉到的。使用的相机是一个半专业的高端设备，佳能5D Mark II。当相机的颜色传感器在21MP和14位raw模式下运行时，采集图像，然后在Adobe camera raw中去除图像，转换为灰度，并向下采样至1MP（有关成像参数，请参阅项目第11页）。我们真实数据集的图像如图5所示（彩色）。这些场景包括一只蚂蚁躺在一棵花状的植物上，一只蜘蛛停在一朵花上，两只无翅目昆虫栖息在一个被白色泡沫覆盖的巢穴上。这个具有挑战性的数据集引入了精细的结构，如蚁狮的萼片和天线，蜘蛛的腿和极细的元素，如蜘蛛毛。通过将相机安装在轨道上并沿光轴在两个镜头之间手动移动来改变焦距设置。由于摄像机位移和光学放大引起的相对S7比例，捕获到的图像会出现错位。偏差分量最大为2像素偏移、0.2°旋转和2.3%比例（基于估计）。表2总结了我们的方法和比较方法的评估偏差。恢复的深度图如图所示。6和7。结果中有趣的细节是蚂蚁和蜘蛛四肢的正确深度顺序。如图6所示，尽管原始数据中的未对准导致损坏的深度映射，但是预先注册确实改善了结果。然而，定性检验表明，虽然对蚂蚁进行SIFT匹配可以获得比较结果，但总体而言，在统一的框架下仍然可以获得最佳结果。在我们的蚁狮深度图中，四肢的距离顺序，特别是翅膀、天线和腿，都得到了正确的恢复。深度分辨率足以暴露昆虫翅膀的倾斜角度。更多细节如图7所示。有趣的是，结果显示在前翼下方存在第二个翅膀，从图像中几乎看不到（参见图7中antlion特写镜头的下排）。这一观测结果显示了亚毫米深度的分辨率。在蜘蛛的例子中，花瓣和蜘蛛的四肢，如头部、腿部和前面的爪子，都按照它们的相对深度顺序得到了很好的恢复。结果表明，无翅目昆虫的巢结构和现存昆虫。比较检查图。6和7显示了我们方法的优点。而在antlion的例子中，基于外观的注册产生了伪影，基于SIFT的alterantive和我们的方法都显示了改进的结果。然而，在蜘蛛测试集中，由于花、蜘蛛头和蜘蛛腿等精细结构的深度不一致，统一方法的性能优于SIFT注册。此外，由于无翅目昆虫的模式相对平滑，SIFT方法失败（由于缺少关键点）。这说明了另一个例子，我们的外观和统一框架比稀疏和独立的方法有优势。在图8中，我们进一步提供了深度图的三维可视化。杰出的细节在这张图中得以体现。请注意蚁狮的双折叠翅膀的3D结构，蜘蛛图像中的花瓣，以及蜘蛛腿、头和爪子的3D姿势。除了深度之外，相对模糊实际上通过确定两个观测值之间的模糊方向来标记更清晰的像素（见第2.3节）。此特性可进一步用于将输入图像融合到具有改进清晰度的新视图中。我们将此新图像称为伪辐射12，并通过以下融合方程进行计算：

其中Heaviside函数提供（软）标签。从实际数据中获得的伪辐射图像如图9所示。请注意这些图像是如何无缝融合的，以显示更清晰的视图。特写镜头描述了输入图像中的相关部分，以及它们对应的、融合到伪辐射图中的更清晰的变体。这是我们可靠的深度订购的结果。在第13页的项目中，我们还提供了用伪辐射图像渲染恢复的形状所创建的三维动画。

###### 6总结讨论

**离焦深度（DFD）利用光学模糊从两幅图像中推断出场景的形状。这种方法的一个重要要求是输入图像之间的精确对齐，而稍有偏差会导致恢复的深度图出现严重误差。以前的DFD方法将图像之间的配准作为一个预处理阶段。然而，随着景深的减小以允许更高的深度分辨率，模糊占主导地位，使标准方法准确记录输入的能力恶化。尽管SIFT点匹配等鲁棒配准方法具有对旋转和尺度不变性以及部分对恒定模糊的不变性，但它们通常缺乏在位移变化特别是非对称模糊情况下精确配准图像的能力。**

fig7--深度贴图的特写镜头（相对模糊）。这些特写显示了从不同方法获得的细节和现有的工件。（a） 没有登记。（b） 基于外观的注册。（c） 筛选匹配。（d） 我们的方法。第一排蚁狮：在头部和腿部观察到异常值。在前翼，我们可以分辨出折叠的副翼，这在图像中几乎看不到。第二排蜘蛛：在花和腿上观察到人工制品。注意，Spider的腿在结果中是正确恢复的，只是在我们的方法中。第三排无翅目昆虫：观察到的不一致用箭头标记，如深度变化剧烈。由于缺少关键点，SIFT匹配在此失败。

基于配准和模糊的耦合特性，提出了一种统一的离焦深度模型。为此，我们形式化地推导了图像形成模型和相应的相对模糊范式。假设物体/摄像机在平面内刚性运动，观察到的图像通过相似变换（除了光学模糊）关联起来。因此，对于旋转对称散焦核，通过将一个图像向另一个图像扭曲来执行的直观配准是正确的。然而，在任意核的情况下，这种关系只满足于对象的纯平移。该框架在一个统一的目标函数中兼顾了配准和深度（相对模糊）。然后通过基于不动点迭代和梯度下降的数值格式来逼近该解。进一步证明了所导出的数值格式与著名的Newton-Raphson方法的等价性，并证明了与线性系统相关的迭代格式的收敛性。这反映了所导出的数值格式的稳定性。金字塔方法（最多2-3个级别）允许恢复大偏差并处理局部最小值。

fig8--彩色编码三维可视化真实数据集（请参阅电子副本或项目页面以获得更好的可视性）。

fig9--合成最佳聚焦图像（伪辐射图像）。（a） 接近焦点。（b） 远焦。（c） 最佳聚焦图像。请注意，当部分在输入中出现焦点内或焦点外时，我们的伪辐射图像包括更清晰的选择。

实验评估包括合成数据以及文献中的真实图像以及野外拍摄的新引入的照片。测试结果表明，目标形状的配准和恢复是成功的。为了强调所建议方法的能力，我们对两个分别进行注册和DFD的备选方案进行了实验评估。结果表明，在配准和深度恢复方面，我们的联合方法优于比较方法。DFD被认为是一种计算密集的三维重建方法。在本文中，我们使用GPU计算来处理计算负担。一种新的数值方案利用GPU计算的良好并行性，使1mp图像的运行时间达到2秒。当DFD在没有DFD的情况下被激活时，计算的瓶颈是注册显式方案，因为如果DFD被激活，吞吐量将增加10倍以上。未来的工作可以朝着不同的方向发展。在理论方面，有空间分析DFD对配准的敏感性。插值在图像扭曲中的影响激发了另一个方向，因为这种近似强加了一个不希望与光学模糊合并的模糊效果。为了进一步加快速度，我们打算将重点放在更有效的方案上，以恢复我们模型中的注册。在多核设备无处不在的时代，该方法为推断真实深度图提供了一种切实可行的替代方法，可进一步用于聚焦操作、目标检测和分割。